{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/paulus/Desktop/automatch/hoc/withAuth.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../store/actions\";\nimport cookies from \"nookies\";\nimport Router from \"next/router\";\n\nvar authenticate = function authenticate(context) {\n  var _cookies$get = cookies.get(context),\n      access_token = _cookies$get.access_token; // Checking if cookie is present\n  // if it is not present, redirect user to signin page\n\n\n  if (context.req && !access_token) {\n    console.log(\"ctx req ====> \", context);\n    context.res.writeHead(302, {\n      Location: \"/\"\n    });\n    context.res.end();\n    return;\n  }\n\n  if (!access_token) {\n    Router.push(\"/\");\n  }\n\n  return access_token;\n};\n\nvar isAuth = function isAuth(context) {\n  var _cookies$get2 = cookies.get(context),\n      access_token = _cookies$get2.access_token;\n\n  return access_token;\n};\n\nvar withAuth = function withAuth(WrappedComponent) {\n  return /*#__PURE__*/function (_Component) {\n    _inherits(_class, _Component);\n\n    var _super = _createSuper(_class);\n\n    function _class() {\n      _classCallCheck(this, _class);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(_class, [{\n      key: \"render\",\n      value: function render() {\n        return __jsx(WrappedComponent, _extends({}, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 45,\n            columnNumber: 14\n          }\n        }));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function getInitialProps(context) {\n        var access_token, componentProps;\n        return _regeneratorRuntime.async(function getInitialProps$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                access_token = authenticate(context);\n                _context.t0 = WrappedComponent.getInitialProps;\n\n                if (!_context.t0) {\n                  _context.next = 6;\n                  break;\n                }\n\n                _context.next = 5;\n                return _regeneratorRuntime.awrap(WrappedComponent.getInitialProps(context));\n\n              case 5:\n                _context.t0 = _context.sent;\n\n              case 6:\n                componentProps = _context.t0;\n                return _context.abrupt(\"return\", _objectSpread({}, componentProps, {\n                  access_token: access_token\n                }));\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      }\n    }]);\n\n    return _class;\n  }(Component);\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    onGetUser: function onGetUser() {\n      return dispatch(actions.getUser());\n    }\n  };\n};\n\nexport default connect(null, mapDispatchToProps)(withAuth);","map":{"version":3,"sources":["/Users/paulus/Desktop/automatch/hoc/withAuth.js"],"names":["Component","connect","actions","cookies","Router","authenticate","context","get","access_token","req","console","log","res","writeHead","Location","end","push","isAuth","withAuth","WrappedComponent","props","getInitialProps","componentProps","mapDispatchToProps","dispatch","onGetUser","getUser"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,SAASC,OAAT,QAAwB,aAAxB;AAEA,OAAO,KAAKC,OAAZ,MAAyB,kBAAzB;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,OAAOC,MAAP,MAAmB,aAAnB;;AAEA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,OAAD,EAAa;AAAA,qBACPH,OAAO,CAACI,GAAR,CAAYD,OAAZ,CADO;AAAA,MACxBE,YADwB,gBACxBA,YADwB,EAGhC;AACA;;;AACA,MAAIF,OAAO,CAACG,GAAR,IAAe,CAACD,YAApB,EAAkC;AAChCE,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BL,OAA9B;AACAA,IAAAA,OAAO,CAACM,GAAR,CAAYC,SAAZ,CAAsB,GAAtB,EAA2B;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAA3B;AACAR,IAAAA,OAAO,CAACM,GAAR,CAAYG,GAAZ;AACA;AACD;;AAED,MAAI,CAACP,YAAL,EAAmB;AACjBJ,IAAAA,MAAM,CAACY,IAAP,CAAY,GAAZ;AACD;;AAED,SAAOR,YAAP;AACD,CAjBD;;AAmBA,IAAMS,MAAM,GAAG,SAATA,MAAS,CAACX,OAAD,EAAa;AAAA,sBACDH,OAAO,CAACI,GAAR,CAAYD,OAAZ,CADC;AAAA,MAClBE,YADkB,iBAClBA,YADkB;;AAE1B,SAAOA,YAAP;AACD,CAHD;;AAKA,IAAMU,QAAQ,GAAG,SAAXA,QAAW,CAACC,gBAAD,EAAsB;AACrC;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,+BAWW;AACP,eAAO,MAAC,gBAAD,eAAsB,KAAKC,KAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAP;AACD;AAbH;AAAA;AAAA,sCAC+Bd,OAD/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAEUE,gBAAAA,YAFV,GAEyBH,YAAY,CAACC,OAAD,CAFrC;AAAA,8BAKMa,gBAAgB,CAACE,eALvB;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,iDAMaF,gBAAgB,CAACE,eAAjB,CAAiCf,OAAjC,CANb;;AAAA;AAAA;;AAAA;AAIUgB,gBAAAA,cAJV;AAAA,mEAQgBA,cARhB;AAQgCd,kBAAAA,YAAY,EAAZA;AARhC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,IAAqBR,SAArB;AAeD,CAhBD;;AAkBA,IAAMuB,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,QAAD,EAAc;AACvC,SAAO;AACLC,IAAAA,SAAS,EAAE;AAAA,aAAMD,QAAQ,CAACtB,OAAO,CAACwB,OAAR,EAAD,CAAd;AAAA;AADN,GAAP;AAGD,CAJD;;AAMA,eAAezB,OAAO,CAAC,IAAD,EAAOsB,kBAAP,CAAP,CAAkCL,QAAlC,CAAf","sourcesContent":["import { Component } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport * as actions from \"../store/actions\";\nimport cookies from \"nookies\";\nimport Router from \"next/router\";\n\nconst authenticate = (context) => {\n  const { access_token } = cookies.get(context);\n\n  // Checking if cookie is present\n  // if it is not present, redirect user to signin page\n  if (context.req && !access_token) {\n    console.log(\"ctx req ====> \", context);\n    context.res.writeHead(302, { Location: \"/\" });\n    context.res.end();\n    return;\n  }\n\n  if (!access_token) {\n    Router.push(\"/\");\n  }\n\n  return access_token;\n};\n\nconst isAuth = (context) => {\n  const { access_token } = cookies.get(context);\n  return access_token;\n};\n\nconst withAuth = (WrappedComponent) => {\n  return class extends Component {\n    static async getInitialProps(context) {\n      const access_token = authenticate(context);\n\n      const componentProps =\n        WrappedComponent.getInitialProps &&\n        (await WrappedComponent.getInitialProps(context));\n\n      return { ...componentProps, access_token };\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    onGetUser: () => dispatch(actions.getUser()),\n  };\n};\n\nexport default connect(null, mapDispatchToProps)(withAuth);\n"]},"metadata":{},"sourceType":"module"}