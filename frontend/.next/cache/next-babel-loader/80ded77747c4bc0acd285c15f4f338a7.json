{"ast":null,"code":"import cookie from \"nookies\";\nimport axios from \"../axios-instance\";\nimport * as actionType from \"./actionTypes\";\n/*** AUTH ***/\n\nexport var authStart = function authStart() {\n  return {\n    type: actionType.AUTH_START\n  };\n};\nexport var authSuccess = function authSuccess(access_token, refresh_token) {\n  return {\n    type: actionType.AUTH_SUCCESS,\n    access_token: access_token,\n    refresh_token: refresh_token\n  };\n};\nexport var authlogout = function authlogout() {\n  return {\n    type: actionType.AUTH_LOGOUT\n  };\n};\n/*** AUTH ***/\n\nexport var refreshTokenSuccess = function refreshTokenSuccess(access_token) {\n  return {\n    type: actionType.REFRESH_TOKEN_SUCCESS,\n    access_token: access_token\n  };\n};\nexport var refreshToken = function refreshToken(refresh_token, ctx) {\n  return function (dispatch) {\n    var _cookie$get = cookie.get(ctx),\n        access_token = _cookie$get.access_token;\n\n    var headerCfg = {\n      headers: {\n        Authorization: \"Bearer \".concat(refresh_token)\n      }\n    };\n\n    if (access_token && refresh_token) {\n      axios.post(\"/refresh\", null, headerCfg).then(function (res) {\n        cookie.set(null, \"access_token\", res.data.access_token, {\n          maxAge: 30 * 24 * 60 * 60,\n          path: \"/\"\n        });\n        dispatch(refreshTokenSuccess(res.data.access_token));\n      })[\"catch\"](function (error) {\n        console.log(error.response);\n      });\n    }\n  };\n};\nexport var authCheckState = function authCheckState(ctx) {\n  return function (dispatch) {\n    dispatch(authStart());\n\n    var _cookie$get2 = cookie.get(ctx),\n        access_token = _cookie$get2.access_token;\n\n    if (access_token) {\n      var _cookie$get3 = cookie.get(ctx),\n          refresh_token = _cookie$get3.refresh_token;\n\n      if (refresh_token) {\n        dispatch(authSuccess(access_token, refresh_token));\n      }\n    } else {\n      dispatch(authlogout());\n    }\n  };\n};","map":{"version":3,"sources":["/Users/paulus/Desktop/automatch/store/actions/auth.js"],"names":["cookie","axios","actionType","authStart","type","AUTH_START","authSuccess","access_token","refresh_token","AUTH_SUCCESS","authlogout","AUTH_LOGOUT","refreshTokenSuccess","REFRESH_TOKEN_SUCCESS","refreshToken","ctx","dispatch","get","headerCfg","headers","Authorization","post","then","res","set","data","maxAge","path","error","console","log","response","authCheckState"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,SAAnB;AACA,OAAOC,KAAP,MAAkB,mBAAlB;AACA,OAAO,KAAKC,UAAZ,MAA4B,eAA5B;AAEA;;AACA,OAAO,IAAMC,SAAS,GAAG,SAAZA,SAAY,GAAM;AAC7B,SAAO;AACLC,IAAAA,IAAI,EAAEF,UAAU,CAACG;AADZ,GAAP;AAGD,CAJM;AAKP,OAAO,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAACC,YAAD,EAAeC,aAAf,EAAiC;AAC1D,SAAO;AACLJ,IAAAA,IAAI,EAAEF,UAAU,CAACO,YADZ;AAELF,IAAAA,YAAY,EAAEA,YAFT;AAGLC,IAAAA,aAAa,EAAEA;AAHV,GAAP;AAKD,CANM;AAOP,OAAO,IAAME,UAAU,GAAG,SAAbA,UAAa,GAAM;AAC9B,SAAO;AACLN,IAAAA,IAAI,EAAEF,UAAU,CAACS;AADZ,GAAP;AAGD,CAJM;AAKP;;AAEA,OAAO,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACL,YAAD,EAAkB;AACnD,SAAO;AACLH,IAAAA,IAAI,EAAEF,UAAU,CAACW,qBADZ;AAELN,IAAAA,YAAY,EAAEA;AAFT,GAAP;AAID,CALM;AAOP,OAAO,IAAMO,YAAY,GAAG,SAAfA,YAAe,CAACN,aAAD,EAAgBO,GAAhB,EAAwB;AAClD,SAAO,UAACC,QAAD,EAAc;AAAA,sBACMhB,MAAM,CAACiB,GAAP,CAAWF,GAAX,CADN;AAAA,QACXR,YADW,eACXA,YADW;;AAEnB,QAAMW,SAAS,GAAG;AAChBC,MAAAA,OAAO,EAAE;AAAEC,QAAAA,aAAa,mBAAYZ,aAAZ;AAAf;AADO,KAAlB;;AAGA,QAAID,YAAY,IAAIC,aAApB,EAAmC;AACjCP,MAAAA,KAAK,CACFoB,IADH,CACQ,UADR,EACoB,IADpB,EAC0BH,SAD1B,EAEGI,IAFH,CAEQ,UAACC,GAAD,EAAS;AACbvB,QAAAA,MAAM,CAACwB,GAAP,CAAW,IAAX,EAAiB,cAAjB,EAAiCD,GAAG,CAACE,IAAJ,CAASlB,YAA1C,EAAwD;AACtDmB,UAAAA,MAAM,EAAE,KAAK,EAAL,GAAU,EAAV,GAAe,EAD+B;AAEtDC,UAAAA,IAAI,EAAE;AAFgD,SAAxD;AAIAX,QAAAA,QAAQ,CAACJ,mBAAmB,CAACW,GAAG,CAACE,IAAJ,CAASlB,YAAV,CAApB,CAAR;AACD,OARH,WASS,UAACqB,KAAD,EAAW;AAChBC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,QAAlB;AACD,OAXH;AAYD;AACF,GAnBD;AAoBD,CArBM;AAuBP,OAAO,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACjB,GAAD,EAAS;AACrC,SAAO,UAACC,QAAD,EAAc;AACnBA,IAAAA,QAAQ,CAACb,SAAS,EAAV,CAAR;;AADmB,uBAEMH,MAAM,CAACiB,GAAP,CAAWF,GAAX,CAFN;AAAA,QAEXR,YAFW,gBAEXA,YAFW;;AAGnB,QAAIA,YAAJ,EAAkB;AAAA,yBACUP,MAAM,CAACiB,GAAP,CAAWF,GAAX,CADV;AAAA,UACRP,aADQ,gBACRA,aADQ;;AAEhB,UAAIA,aAAJ,EAAmB;AACjBQ,QAAAA,QAAQ,CAACV,WAAW,CAACC,YAAD,EAAeC,aAAf,CAAZ,CAAR;AACD;AACF,KALD,MAKO;AACLQ,MAAAA,QAAQ,CAACN,UAAU,EAAX,CAAR;AACD;AACF,GAXD;AAYD,CAbM","sourcesContent":["import cookie from \"nookies\";\nimport axios from \"../axios-instance\";\nimport * as actionType from \"./actionTypes\";\n\n/*** AUTH ***/\nexport const authStart = () => {\n  return {\n    type: actionType.AUTH_START,\n  };\n};\nexport const authSuccess = (access_token, refresh_token) => {\n  return {\n    type: actionType.AUTH_SUCCESS,\n    access_token: access_token,\n    refresh_token: refresh_token,\n  };\n};\nexport const authlogout = () => {\n  return {\n    type: actionType.AUTH_LOGOUT,\n  };\n};\n/*** AUTH ***/\n\nexport const refreshTokenSuccess = (access_token) => {\n  return {\n    type: actionType.REFRESH_TOKEN_SUCCESS,\n    access_token: access_token,\n  };\n};\n\nexport const refreshToken = (refresh_token, ctx) => {\n  return (dispatch) => {\n    const { access_token } = cookie.get(ctx);\n    const headerCfg = {\n      headers: { Authorization: `Bearer ${refresh_token}` },\n    };\n    if (access_token && refresh_token) {\n      axios\n        .post(\"/refresh\", null, headerCfg)\n        .then((res) => {\n          cookie.set(null, \"access_token\", res.data.access_token, {\n            maxAge: 30 * 24 * 60 * 60,\n            path: \"/\",\n          });\n          dispatch(refreshTokenSuccess(res.data.access_token));\n        })\n        .catch((error) => {\n          console.log(error.response);\n        });\n    }\n  };\n};\n\nexport const authCheckState = (ctx) => {\n  return (dispatch) => {\n    dispatch(authStart());\n    const { access_token } = cookie.get(ctx);\n    if (access_token) {\n      const { refresh_token } = cookie.get(ctx);\n      if (refresh_token) {\n        dispatch(authSuccess(access_token, refresh_token));\n      }\n    } else {\n      dispatch(authlogout());\n    }\n  };\n};\n"]},"metadata":{},"sourceType":"module"}