{"ast":null,"code":"import Router from \"next/router\";\nimport cookie from \"nookies\";\nimport axios from \"../axios-instance\";\nimport * as actionType from \"./actionTypes\";\n/*** AUTH ***/\n\nexport const authStart = () => {\n  return {\n    type: actionType.AUTH_START\n  };\n};\nexport const authSuccess = (access_token, refresh_token) => {\n  return {\n    type: actionType.AUTH_SUCCESS,\n    access_token: access_token,\n    refresh_token: refresh_token\n  };\n};\nexport const authlogout = () => {\n  return {\n    type: actionType.AUTH_LOGOUT\n  };\n};\nexport const refreshTokenSuccess = access_token => {\n  return {\n    type: actionType.REFRESH_TOKEN_SUCCESS,\n    access_token: access_token\n  };\n};\n/*** AUTH ***/\n\nexport const getUserSuccess = user => {\n  return {\n    type: actionType.GET_USER,\n    user: user\n  };\n};\nexport const getUser = ctx => {\n  return dispatch => {\n    const {\n      access_token\n    } = cookie.get(ctx);\n    const headerCfg = {\n      headers: {\n        Authorization: `Bearer ${access_token}`\n      }\n    };\n    axios.get(\"/user\", headerCfg).then(res => {\n      dispatch(getUserSuccess(res.data));\n    }).catch(err => {\n      if (err.response.status === 422) {\n        cookie.destroy(ctx, \"access_token\");\n        cookie.destroy(ctx, \"refresh_token\");\n        dispatch(authlogout());\n        swal({\n          title: \"Uuppsss!\",\n          text: \"Invalid user credential, please re-login!\",\n          icon: \"error\"\n        });\n        Router.reload(\"/\");\n      }\n    });\n  };\n};\nexport const logout = ctx => {\n  return dispatch => {\n    const {\n      access_token\n    } = cookie.get(ctx);\n    const headerCfg = {\n      headers: {\n        Authorization: `Bearer ${access_token}`\n      }\n    };\n    axios.delete(\"/logout\", headerCfg).then(() => {\n      dispatch(authlogout());\n      Router.reload(\"/\");\n    });\n  };\n};\nexport const refreshToken = (refresh_token, ctx) => {\n  return dispatch => {\n    const {\n      access_token\n    } = cookie.get(ctx);\n    const headerCfg = {\n      headers: {\n        Authorization: `Bearer ${refresh_token}`\n      }\n    };\n\n    if (access_token && refresh_token) {\n      axios.post(\"/refresh\", null, headerCfg).then(res => {\n        cookie.set(null, \"access_token\", res.data.access_token, {\n          maxAge: 30 * 24 * 60 * 60,\n          path: \"/\"\n        });\n        dispatch(refreshTokenSuccess(res.data.access_token));\n      }).catch(error => {\n        console.log(error.response);\n      });\n    }\n  };\n};\nexport const authCheckState = ctx => {\n  return dispatch => {\n    dispatch(authStart());\n    const {\n      access_token\n    } = cookie.get(ctx);\n\n    if (access_token) {\n      const {\n        refresh_token\n      } = cookie.get(ctx);\n\n      if (refresh_token) {\n        dispatch(authSuccess(access_token, refresh_token));\n      }\n    } else {\n      dispatch(authlogout());\n    }\n  };\n};","map":{"version":3,"sources":["/Users/paulus/Desktop/automatch/store/actions/auth.js"],"names":["Router","cookie","axios","actionType","authStart","type","AUTH_START","authSuccess","access_token","refresh_token","AUTH_SUCCESS","authlogout","AUTH_LOGOUT","refreshTokenSuccess","REFRESH_TOKEN_SUCCESS","getUserSuccess","user","GET_USER","getUser","ctx","dispatch","get","headerCfg","headers","Authorization","then","res","data","catch","err","response","status","destroy","swal","title","text","icon","reload","logout","delete","refreshToken","post","set","maxAge","path","error","console","log","authCheckState"],"mappings":"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","sourcesContent":["import Router from \"next/router\";\nimport cookie from \"nookies\";\nimport axios from \"../axios-instance\";\nimport * as actionType from \"./actionTypes\";\n\n/*** AUTH ***/\nexport const authStart = () => {\n  return {\n    type: actionType.AUTH_START,\n  };\n};\nexport const authSuccess = (access_token, refresh_token) => {\n  return {\n    type: actionType.AUTH_SUCCESS,\n    access_token: access_token,\n    refresh_token: refresh_token,\n  };\n};\nexport const authlogout = () => {\n  return {\n    type: actionType.AUTH_LOGOUT,\n  };\n};\nexport const refreshTokenSuccess = (access_token) => {\n  return {\n    type: actionType.REFRESH_TOKEN_SUCCESS,\n    access_token: access_token,\n  };\n};\n/*** AUTH ***/\n\nexport const getUserSuccess = (user) => {\n  return {\n    type: actionType.GET_USER,\n    user: user,\n  };\n};\n\nexport const getUser = (ctx) => {\n  return (dispatch) => {\n    const { access_token } = cookie.get(ctx);\n    const headerCfg = {\n      headers: { Authorization: `Bearer ${access_token}` },\n    };\n    axios\n      .get(\"/user\", headerCfg)\n      .then((res) => {\n        dispatch(getUserSuccess(res.data));\n      })\n      .catch((err) => {\n        if (err.response.status === 422) {\n          cookie.destroy(ctx, \"access_token\");\n          cookie.destroy(ctx, \"refresh_token\");\n          dispatch(authlogout());\n          swal({\n            title: \"Uuppsss!\",\n            text: \"Invalid user credential, please re-login!\",\n            icon: \"error\",\n          });\n          Router.reload(\"/\");\n        }\n      });\n  };\n};\n\nexport const logout = (ctx) => {\n  return (dispatch) => {\n    const { access_token } = cookie.get(ctx);\n    const headerCfg = {\n      headers: { Authorization: `Bearer ${access_token}` },\n    };\n    axios.delete(\"/logout\", headerCfg).then(() => {\n      dispatch(authlogout());\n      Router.reload(\"/\");\n    });\n  };\n};\n\nexport const refreshToken = (refresh_token, ctx) => {\n  return (dispatch) => {\n    const { access_token } = cookie.get(ctx);\n    const headerCfg = {\n      headers: { Authorization: `Bearer ${refresh_token}` },\n    };\n    if (access_token && refresh_token) {\n      axios\n        .post(\"/refresh\", null, headerCfg)\n        .then((res) => {\n          cookie.set(null, \"access_token\", res.data.access_token, {\n            maxAge: 30 * 24 * 60 * 60,\n            path: \"/\",\n          });\n          dispatch(refreshTokenSuccess(res.data.access_token));\n        })\n        .catch((error) => {\n          console.log(error.response);\n        });\n    }\n  };\n};\n\nexport const authCheckState = (ctx) => {\n  return (dispatch) => {\n    dispatch(authStart());\n    const { access_token } = cookie.get(ctx);\n    if (access_token) {\n      const { refresh_token } = cookie.get(ctx);\n      if (refresh_token) {\n        dispatch(authSuccess(access_token, refresh_token));\n      }\n    } else {\n      dispatch(authlogout());\n    }\n  };\n};\n"]},"metadata":{},"sourceType":"module"}